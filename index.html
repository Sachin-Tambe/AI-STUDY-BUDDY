<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign In with Google using Supabase</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <div class="container">
    <h1>Sign In with Google</h1>
    <button id="google-signin">Sign in with Google</button>
    <div id="message"></div>
  </div>

  <!-- Import Supabase using ES modules -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // Initialize Supabase client using environment variables.
    // These variables should be defined in your .env file (e.g. .env.local for Next.js)
    // and injected at build time.
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
    const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
    const supabase = createClient(supabaseUrl, supabaseKey);

    const signInButton = document.getElementById('google-signin');
    const messageDiv = document.getElementById('message');

    // Listen for authentication state changes.
    supabase.auth.onAuthStateChange((event, session) => {
      console.log("Auth event:", event, "Session:", session);
      if (session) {
        // Redirect to main.html once a session is established.
        window.location.href = '/main.html';
      }
    });

    signInButton.addEventListener('click', async () => {
      messageDiv.textContent = "Redirecting to Google for sign in...";

      // Initiate the OAuth flow with a redirect to main.html.
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: {
          redirectTo: window.location.origin + '/main.html'
        }
      });

      if (error) {
        messageDiv.textContent = "Error: " + error.message;
        console.error("Error signing in:", error);
      }
    });
  </script>
</body>
</html>
